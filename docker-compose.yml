version: '3'

services:
    # elasticsearch:
    #     image: docker.elastic.co/elasticsearch/elasticsearch:7.14.0
    #     container_name: elasticsearch
    #     environment:
    #     - discovery.type=single-node
    #     - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    #     ports:
    #     - 9200:9200
    # kibana:
    #     image: docker.elastic.co/kibana/kibana:7.14.0
    #     container_name: kibana
    #     ports:
    #         - 5601:5601
    #     environment:
    #         ELASTICSEARCH_URL: http://elasticsearch:9200
    #     depends_on:
    #         - elasticsearch
    commerce_db:
        image: postgres
        env_file: .env
        environment:
            POSTGRES_DB: ${TYPEORM_DATABASE}
            POSTGRES_USER: ${TYPEORM_USERNAME}
            POSTGRES_PASSWORD: ${TYPEORM_PASSWORD}
        ports:
            - "5432:5432"
    commerce_sys:
        env_file: .env
        build: .
        command: npm run start:debug
        volumes:
            - .:/code
        ports:
            - "${API_PORT}:${API_PORT}"
            - "9229:9229"

networks:
    default:
        name: api
        external: true